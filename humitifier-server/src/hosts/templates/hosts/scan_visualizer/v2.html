{% load host_tags %}
{% load param_replace %}

<div class="grid grid-cols-[auto,400px] grid-rows-[3.5rem,1fr] sticky left-0 top-[69px] h-max-full--header overflow-hidden">
    <div class="bg border-b border-gray-300 dark:border-gray-700 px-6 py-4 sticky top-0 z-10">
        <div class="font-bold text-lg">{{ host.fqdn }}</div>
    </div>

    <div class="h-full w-full p-5 row-span-2 bg border-l border-gray-300 dark:border-gray-700">

        <form method="get" class="flex gap-3 items-center mb-5" x-data="{}" x-ref="scanForm">
            <label for="scan" class="text-nowrap">Select scan:</label>
            <select id="scan" name="scan" class="input flex-grow" @change="$refs.scanForm.submit()">
                <option {% if current_scan == 'latest' %}selected{% endif %} value="latest">
                    Latest scan
                </option>
                {% for scan in all_scans %}
                    <option value="{{ scan.isoformat }}" {% if current_scan == scan.isoformat %}selected{% endif%}>
                        {{ scan|date:"Y-m-d H:i" }}
                    </option>
                {% endfor %}
            </select>
        </form>

        <h3 class="text-xl font-bold mb-4">
            Static config
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-[1fr_2fr] items-top gap-y-2">
            {% for item in static_data %}
                <div class="font-semibold">{{ item.label }}</div>
                <div class="">
                    {% if item.value %}
                        {{ item.value }}
                    {% else %}
                        <div class="text-gray-500">Unknown</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

        <h3 class="text-xl font-bold mb-3 mt-8">
            Actions
        </h3>
        <div class="flex flex-col gap-2">

            <a class="btn btn-outline" href="{% url 'hosts:download_raw' host.fqdn %}?{% param_replace %}">
                Download raw data
            </a>
            <div class="btn btn-outline">
                Archive
            </div>
            <div class="btn btn-outline">
                Edit host config
            </div>
            <div class="btn btn-outline">
                Queue metric rescan
            </div>
            <div class="btn btn-outline">
                Queue full rescan
            </div>
        </div>
    </div>


    <div class="overflow-auto p-3 pt-0">
        {% if is_latest_scan %}
            {% for alert in alerts %}
                {% if alert.level == 'critical' %}
                    {% include 'hosts/host_detail_parts/alerts/critical.html' %}
                {% elif alert.level == 'warning' %}
                    {% include 'hosts/host_detail_parts/alerts/warning.html' %}
                {% elif alert.level == 'info' %}
                    {% include 'hosts/host_detail_parts/alerts/info.html' %}
                {% endif %}
            {% endfor %}
        {% else %}
            {% with alert="This is historical data, it does not reflect the current configuration." %}
                {% include 'hosts/host_detail_parts/alerts/warning.html' %}
            {% endwith %}
        {% endif %}

        {% if host.archived %}
            {% with alert=host.archived_string %}
                {% include 'hosts/host_detail_parts/alerts/info.html' %}
            {% endwith %}
        {% endif %}

        <div  x-data="{componentSearch: ''}">
            <div class="flex items-center w-full px-2 pt-5 pb-4">
                <h1 class="text-2xl font-bold mr-auto">Metrics</h1>

                <input placeholder="Search metrics" class="input w-40" x-model="componentSearch">
            </div>
            <div class="columns-1 2xl:columns-2 ultrawide:columns-3 gap-4 px-2">
                {% for component, content in metrics.items %}
                    <div x-data="{ title: '{{ component }} '}" x-bind:class="title.toLowerCase().includes(componentSearch.toLowerCase()) ? '' : 'hidden' ">
                        {{ content }}
                    </div>
                {% endfor %}
            </div>
        </div>

        <div  x-data="{componentSearch: ''}">
            <div class="flex items-center w-full px-2 pt-5 pb-4">
                <h1 class="text-2xl font-bold mr-2">Facts</h1>

                <div class="text-xl text-gray-700 dark:text-gray-500 mr-auto">
                    - {{ current_scan_date|date:"Y-m-d H:i" }}
                </div>

                <input placeholder="Search facts" class="input w-40" x-model="componentSearch">
            </div>


            <div class="columns-1 2xl:columns-2 ultrawide:columns-3 gap-4 px-2">
                {% for component, content in facts.items %}
                    <div x-data="{ title: '{{ component }} '}" x-bind:class="title.toLowerCase().includes(componentSearch.toLowerCase()) ? '' : 'hidden' ">
                        {{ content }}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

